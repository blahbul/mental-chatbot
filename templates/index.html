<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mental Health Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #010808; }
        .chat-bubble { padding: 1rem; border-radius: 1.5rem; max-width: 80%; line-height: 1.5; word-wrap: break-word; }
        .user-bubble { background-color: #67bed9; color: #1a202c; border-bottom-right-radius: 0.5rem; align-self: flex-end; }
        .bot-bubble { background-color: #9ddcb5; color: #1a202c; border-bottom-left-radius: 0.5rem; align-self: flex-start; }
        #input-area { background-color: #1c1c1c; border-top: 1px solid #363636; }
        #user-input { background-color: #363636; color: #ffffff; border-radius: 9999px; }
        #send-button, #voice-button { background-color: #67bed9; color: #010808; }
        .panel { display: none; }
        .panel.active { display: flex; }
        .scroll-bar::-webkit-scrollbar { width: 8px; }
        .scroll-bar::-webkit-scrollbar-track { background: transparent; }
        .scroll-bar::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.1); border-radius: 4px; }
        .voice-visualizer { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; position: relative; }
        .voice-circle { position: absolute; width: 150px; height: 150px; border-radius: 50%; background: rgba(103, 190, 217, 0.5); animation: pulse 2s infinite ease-out; opacity: 0; }
        .voice-circle.two { animation-delay: 0.5s; }
        .voice-circle.three { animation-delay: 1s; }
        @keyframes pulse { 0% { transform: scale(0.5); opacity: 0; } 50% { opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }
        #checkin-modal { display: none; }
        .breathing-circle { width: 150px; height: 150px; background: radial-gradient(circle at center, #67bed9, #9ddcb5); border-radius: 50%; transition: transform 4s ease-in-out; }
        .breathing-container.grow .breathing-circle { transform: scale(1.5); }
        .breathing-container.shrink .breathing-circle { transform: scale(1); }
        .toggle-checkbox:checked { right: 0; border-color: #67bed9; }
        .toggle-checkbox:checked + .toggle-label { background-color: #67bed9; }
        #language-select { background-color: #363636; color: white; border-radius: 0.5rem; padding: 0.5rem; border: 1px solid #4a5568;}
        #voice-select { background-color: #363636; color: white; border-radius: 0.5rem; padding: 0.5rem; border: 1px solid #4a5568;}
    </style>
</head>
<body class="flex items-center justify-center min-h-screen text-white">
    <div id="app" class="w-full max-w-md flex flex-col h-[95vh] rounded-[3rem] shadow-2xl overflow-hidden relative bg-[#0D1018]">
        
        <div id="main-panel" class="panel active flex-col h-full bg-inherit text-center p-6 justify-center">
            <button onclick="showPanel('settings-panel')" class="absolute top-6 right-6 p-2 text-gray-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.43.992a6.759 6.759 0 0 1 0 1.905c.008.379.137.752.43.992l1.004.827a1.125 1.125 0 0 1 .26 1.431l-1.296 2.247a1.125 1.125 0 0 1-1.37.49l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.063-.374-.313-.686-.645-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.075-.124l-1.217.456a1.125 1.125 0 0 1-1.37-.49l-1.296-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.759 6.759 0 0 1 0-1.905c-.008-.379-.137-.752-.43-.992l-1.003-.827a1.125 1.125 0 0 1-.26-1.431l1.296-2.247a1.125 1.125 0 0 1 1.37-.49l1.217.456c.355.133.75.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
            </button>
            <img src="{{ url_for('static', filename='robot.png') }}" alt="Chatbot Assistant" class="w-32 h-32 mx-auto mb-4">
            <h1 id="main-title" class="text-4xl font-bold text-white mb-2"></h1>
            <p id="main-subtitle" class="text-gray-400 text-lg mb-8"></p>
            <div class="space-y-4">
                <button id="btn-talk" class="w-full p-4 rounded-full bg-gray-800 hover:bg-gray-700 font-semibold flex items-center justify-center" onclick="showPanel('chat-panel')">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z" /></svg>
                    <span id="text-btn-talk"></span>
                </button>
                <button id="btn-breathing" class="w-full p-4 rounded-full bg-gray-800 hover:bg-gray-700 font-semibold flex items-center justify-center" onclick="showPanel('breathing-panel')">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>
                    <span id="text-btn-breathing"></span>
                </button>
                <button id="btn-mood" class="w-full p-4 rounded-full bg-gray-800 hover:bg-gray-700 font-semibold flex items-center justify-center" onclick="showPanel('mood-tracker-panel')">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" /></svg>
                    <span id="text-btn-mood"></span>
                </button>
                <button id="btn-journal" class="w-full p-4 rounded-full bg-gray-800 hover:bg-gray-700 font-semibold flex items-center justify-center" onclick="showPanel('journaling-panel')">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>
                    <span id="text-btn-journal"></span>
                </button>
                <button id="btn-counselor" class="w-full p-4 rounded-full bg-gray-800 hover:bg-gray-700 font-semibold flex items-center justify-center" onclick="showPanel('counselor-panel')">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.157.448l-1.076 1.076a1.523 1.523 0 0 1-1.886.121 11.234 11.234 0 0 1-5.496-5.496 1.523 1.523 0 0 1 .121-1.886l1.076-1.076c.393-.393.558-.917.448-1.157L6.627 2.25C6.496 1.749 6.046 1.4 5.53 1.4H4.25a2.25 2.25 0 0 0-2.25 2.25v1.5Z" /></svg>
                    <span id="text-btn-counselor"></span>
                </button>
            </div>
        </div>
        <div id="settings-panel" class="panel flex-col h-full bg-inherit">
    <div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800">
        <button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="showPanel('main-panel')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg>
        </button>
        <h1 id="title-settings" class="text-xl font-semibold text-white"></h1>
        <div></div>
    </div>
    <div class="flex-1 p-6 space-y-6">
        <div>
            <h2 id="subtitle-voice" class="text-lg font-semibold text-gray-300 mb-2"></h2>
            <div class="bg-gray-800 rounded-lg p-4 flex items-center justify-between mb-4">
                <label for="voice-toggle" id="label-voice" class="text-white"></label>
                <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="voice-toggle" id="voice-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                    <label for="voice-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                </div>
            </div>
            <div class="bg-gray-800 rounded-lg p-4 flex items-center justify-between">
                <label for="voice-select" id="label-voice-select" class="text-white"></label>
                <select id="voice-select" name="voice" class="bg-gray-700 text-white rounded-md p-2 w-1/2 max-w-[150px]"></select>
            </div>
        </div>
        <div>
            <h2 id="subtitle-language" class="text-lg font-semibold text-gray-300 mb-2"></h2>
            <div class="bg-gray-800 rounded-lg p-4 flex items-center justify-between">
                <label for="language-select" id="label-language" class="text-white"></label>
                <select id="language-select" name="language" class="bg-gray-700 text-white rounded-md p-2">
                    <option value="en">English</option>
                </select>
            </div>
        </div>
    </div>
</div>
        <div id="breathing-panel" class="panel flex-col h-full bg-inherit"><div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800"><button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="showPanel('main-panel')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg></button><h1 id="title-breathing" class="text-xl font-semibold text-white"></h1><div></div></div><div class="flex-1 flex flex-col items-center justify-center p-4 space-y-8"><p id="breathing-text" class="text-3xl font-semibold text-center h-10"></p><div id="breathing-container" class="breathing-container"><div class="breathing-circle"></div></div></div></div>
        <div id="mood-tracker-panel" class="panel flex-col h-full bg-inherit"><div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800"><button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="showPanel('main-panel')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg></button><h1 id="title-mood" class="text-xl font-semibold text-white"></h1><div></div></div><div class="flex-1 p-4"><canvas id="moodChart"></canvas></div></div>
        <div id="chat-panel" class="panel flex-col h-full bg-inherit"><div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800"><button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="window.speechSynthesis.cancel(); showPanel('main-panel')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg></button><h1 id="chat-header" class="text-xl font-semibold text-white">Phoenix</h1><button id="history-button" class="text-white p-2 rounded-full hover:bg-gray-800"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg></button></div><div id="chat-box" class="flex-1 overflow-y-auto p-4 flex flex-col gap-4 scroll-bar"></div><div id="input-area" class="p-4 flex items-center gap-2"><input type="text" id="user-input" placeholder="Type your message..." class="flex-1 p-3 px-5 border-none focus:outline-none"><button id="voice-button" class="p-3 rounded-full hover:opacity-90"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 0 0 6-6v-1.5a6 6 0 1 0-12 0v1.5a6 6 0 0 0 6 6Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v3M15 9.75v-1.5a3 3 0 0 0-6 0v1.5" /></svg></button><button id="send-button" class="p-3 rounded-full hover:opacity-90"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.769 59.769 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" /></svg></button></div></div>
        <div id="journaling-panel" class="panel flex-col h-full bg-inherit"><div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800"><button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="showPanel('main-panel')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg></button><h1 id="title-journal" class="text-xl font-semibold text-white"></h1><div class="flex items-center gap-2"><button id="btn-view-journals" class="bg-gray-800 text-white px-4 py-2 rounded-full hover:bg-gray-700 font-semibold"><span id="text-btn-view-journals"></span></button><button id="btn-save-journal" class="bg-[#67bed9] text-[#010808] px-4 py-2 rounded-full hover:opacity-90 font-semibold"><span id="text-btn-save-journal"></span></button></div></div><div class="p-4 flex-1 flex flex-col"><button id="btn-new-page" class="w-full mb-4 p-2 rounded-full bg-gray-800 hover:bg-gray-700 font-semibold"><span id="text-btn-new-page"></span></button><textarea id="journal-textarea" class="w-full flex-1 p-4 rounded-2xl bg-[#010808] text-white border-2 border-gray-800 focus:outline-none focus:border-[#67bed9]" placeholder="Start writing here..."></textarea></div></div>
        <div id="view-journals-panel" class="panel flex-col h-full bg-inherit"><div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800"><button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="showPanel('journaling-panel')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg></button><h1 id="title-past-journals" class="text-xl font-semibold text-white"></h1><div></div></div><div id="journal-list" class="flex-1 overflow-y-auto p-4 space-y-2 scroll-bar"></div></div>
        <div id="full-journal-panel" class="panel flex-col h-full bg-inherit"><div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800"><button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="showPanel('view-journals-panel')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg></button><h1 id="full-journal-title" class="text-xl font-semibold text-white"></h1><div></div></div><div id="full-journal-content" class="flex-1 overflow-y-auto p-6 space-y-2 scroll-bar whitespace-pre-wrap"></div></div>
        <div id="counselor-panel" class="panel flex-col h-full bg-inherit"><div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800"><button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="showPanel('main-panel')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg></button><h1 id="title-counselor" class="text-xl font-semibold text-white"></h1><div></div></div><div class="flex-1 overflow-y-auto p-4 text-left scroll-bar"><p id="counselor-subtitle" class="text-lg font-semibold text-red-400 mb-4 text-center"></p><div class="bg-gray-800 rounded-2xl p-6 shadow-lg space-y-3 mb-4"><p class="text-xl font-bold text-gray-200">KIRAN Mental Health Helpline</p><p class="text-sm text-gray-400">A 24/7 national helpline by the Govt. of India.</p><a href="tel:1800-599-0019" class="block text-2xl text-red-500 font-extrabold hover:text-red-400">1800-599-0019</a></div><div class="bg-gray-800 rounded-2xl p-6 shadow-lg space-y-3 mb-4"><p class="text-xl font-bold text-gray-200">Vandrevala Foundation</p><p class="text-sm text-gray-400">A non-profit offering free psychological counseling.</p><a href="tel:9999666555" class="block text-2xl text-red-500 font-extrabold hover:text-red-400">9999666555</a></div><div class="bg-gray-800 rounded-2xl p-6 shadow-lg space-y-3"><p class="text-xl font-bold text-gray-200">iCALL Psychosocial Helpline</p><p class="text-sm text-gray-400">Run by the Tata Institute of Social Sciences.</p><a href="tel:9152987821" class="block text-2xl text-red-500 font-extrabold hover:text-red-400">9152987821</a></div></div></div>
        <div id="history-panel" class="panel flex-col h-full bg-inherit p-6"><div class="p-4 bg-inherit shadow-md flex items-center justify-between border-b border-gray-800"><button class="text-white p-2 rounded-full hover:bg-gray-800" onclick="showPanel('chat-panel')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-4.5" /></svg></button><h1 id="title-history" class="text-xl font-semibold text-white"></h1><div></div></div><div id="history-list" class="flex-1 overflow-y-auto mt-4 space-y-2 scroll-bar"></div><button id="btn-new-chat" class="w-full mt-6 p-4 rounded-full bg-[#67bed9] text-[#010808] font-bold hover:opacity-90"><span id="text-btn-new-chat"></span></button></div>
        <div id="listening-panel" class="panel flex-col items-center justify-center p-8 bg-inherit text-center w-full h-full absolute top-0 left-0"><div class="voice-visualizer"><div class="voice-circle one"></div> <div class="voice-circle two"></div> <div class="voice-circle three"></div></div><p id="listening-text" class="text-xl mt-8 text-gray-300"></p><button id="btn-keyboard" class="mt-4 px-4 py-2 rounded-full bg-gray-800 text-gray-300 hover:bg-gray-700"><span id="text-btn-keyboard"></span></button></div>
        <div id="checkin-modal" class="fixed inset-0 z-50 items-center justify-center bg-black/70 p-4"><div class="bg-[#0D1018] border border-gray-800 w-full max-w-sm mx-auto rounded-3xl p-6 text-center"><div id="mood-selection"><h2 id="modal-title" class="text-2xl font-bold mb-4"></h2><div class="flex justify-center items-center gap-4"><button class="mood-btn text-5xl transform hover:scale-110 transition-transform" data-mood="sad">😔</button><button class="mood-btn text-5xl transform hover:scale-110 transition-transform" data-mood="neutral">😐</button><button class="mood-btn text-5xl transform hover:scale-110 transition-transform" data-mood="happy">😊</button></div></div><div id="affirmation-view" class="hidden"><h2 id="affirmation-title" class="text-2xl font-bold mb-2"></h2><p id="affirmation-text" class="text-lg text-gray-300 mb-6"></p><button id="close-modal-btn" class="w-full p-3 rounded-full bg-[#67bed9] text-[#010808] font-bold hover:opacity-90"></button></div></div></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const languageStrings = {
                en: {
                    "main-title": "Hi There!", "main-subtitle": "How can I help you today?", "text-btn-talk": "Talk with Phoenix", "text-btn-breathing": "Guided Breathing", "text-btn-mood": "Mood Tracker", "text-btn-journal": "User Journal", "text-btn-counselor": "Talk to a Counselor", "title-settings": "Settings", "subtitle-voice": "Voice Settings", "label-voice": "Enable Chatbot Voice", "label-voice-select": "Select Voice", "subtitle-language": "Language", "label-language": "Select Language", "title-breathing": "Guided Breathing", "title-mood": "Mood Tracker", "title-journal": "User Journal", "text-btn-view-journals": "View Journals", "text-btn-save-journal": "Save", "text-btn-new-page": "New Page", "title-past-journals": "Past Journals", "title-counselor": "Talk to a Counselor", "counselor-subtitle": "If you are in distress, please reach out.", "title-history": "Chat History", "text-btn-new-chat": "+ New Chat", "listening-text": "Listening...", "text-btn-keyboard": "Use Keyboard", "modal-title": "How are you feeling today?", "affirmation-title": "Your affirmation for today:", "close-modal-btn": "Continue"
                }
            };
            
            const languageSelect = document.getElementById('language-select');
            const voiceSelect = document.getElementById('voice-select');
            const voiceToggle = document.getElementById('voice-toggle');
            const userInput = document.getElementById('user-input'), sendButton = document.getElementById('send-button'), voiceButton = document.getElementById('voice-button');
            const chatBox = document.getElementById('chat-box'), chatHeader = document.getElementById('chat-header');
            const historyList = document.getElementById('history-list'), historyButton = document.getElementById('history-button'), newChatButton = document.getElementById('btn-new-chat');
            const journalTextarea = document.getElementById('journal-textarea'), saveJournalButton = document.getElementById('btn-save-journal'), viewJournalsButton = document.getElementById('btn-view-journals');
            const journalList = document.getElementById('journal-list'), newPageButton = document.getElementById('btn-new-page');
            const fullJournalTitle = document.getElementById('full-journal-title'), fullJournalContent = document.getElementById('full-journal-content');
            const keyboardButton = document.getElementById('btn-keyboard');
            const checkinModal = document.getElementById('checkin-modal'), moodSelectionView = document.getElementById('mood-selection'), affirmationView = document.getElementById('affirmation-view'), affirmationText = document.getElementById('affirmation-text'), moodButtons = document.querySelectorAll('.mood-btn'), closeModalBtn = document.getElementById('close-modal-btn');
            const breathingContainer = document.getElementById('breathing-container');
            const breathingText = document.getElementById('breathing-text');
            let currentChatMessages = []; let currentSessionId = crypto.randomUUID(); let isListening = false; let isFirstTimeChatView = true; let moodChart = null; let breathingInterval = null; let isVoiceEnabled = true;
            const affirmations = ["I am capable of handling whatever comes my way.", "I choose to be happy and to love myself today.", "My potential to succeed is infinite.", "I am resilient and can overcome any challenge.", "I am worthy of peace and happiness."];
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = false; recognition.lang = 'en-US';
            
            function initializeSettings() {
                const savedVoiceSetting = localStorage.getItem('isVoiceEnabled');
                if (savedVoiceSetting === 'false') { isVoiceEnabled = false; voiceToggle.checked = false; } else { isVoiceEnabled = true; voiceToggle.checked = true; }
            }

            function changeLanguage(lang) {
                if (!languageStrings[lang]) return;
                Object.keys(languageStrings[lang]).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) { element.textContent = languageStrings[lang][id]; }
                });
                localStorage.setItem('selectedLanguage', lang);
            }

            function initializeLanguage() {
                const savedLang = localStorage.getItem('selectedLanguage') || 'en';
                languageSelect.value = savedLang;
                changeLanguage(savedLang);
            }

            function loadVoices() {
                const intervalId = setInterval(() => {
                    const voices = window.speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        clearInterval(intervalId);
                        voices.forEach(voice => {
                            const option = document.createElement('option');
                            option.textContent = `${voice.name} (${voice.lang})`;
                            option.setAttribute('data-name', voice.name);
                            voiceSelect.appendChild(option);
                        });
                    }
                }, 50);
            }

            function speakMessage(text) { 
                if (!isVoiceEnabled) return;
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                const selectedVoiceName = voiceSelect.options[voiceSelect.selectedIndex].getAttribute('data-name');
                const selectedVoice = window.speechSynthesis.getVoices().find(voice => voice.name === selectedVoiceName);
                if (selectedVoice) { u.voice = selectedVoice; }
                u.rate = 1.0;
                window.speechSynthesis.speak(u);
            }

            window.showPanel = function(id) { 
                stopBreathingExercise();
                document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
                const activePanel = document.getElementById(id);
                if (activePanel) { activePanel.classList.add('active'); }
                if (id === 'chat-panel' && isFirstTimeChatView) { if (currentChatMessages.length > 0 && currentChatMessages[0].sender === 'bot') { speakMessage(currentChatMessages[0].text); } isFirstTimeChatView = false; }
                if (id === 'history-panel') loadHistoryPanel();
                if (id === 'view-journals-panel') loadJournalList();
                if (id === 'mood-tracker-panel') loadMoodData();
                if (id === 'breathing-panel') startBreathingExercise();
            }
            function startBreathingExercise() { const totalCycle = 12000; function runCycle() { breathingText.textContent = 'Breathe In...'; breathingContainer.classList.add('grow'); setTimeout(() => { breathingText.textContent = 'Hold'; }, 4000); setTimeout(() => { breathingText.textContent = 'Breathe Out...'; breathingContainer.classList.remove('grow'); }, 8000); } runCycle(); breathingInterval = setInterval(runCycle, totalCycle); }
            function stopBreathingExercise() { if (breathingInterval) { clearInterval(breathingInterval); breathingInterval = null; } }
            function handleDailyCheckin() { const today = new Date().toISOString().split('T')[0]; const lastCheckin = localStorage.getItem('lastCheckinDate'); if (lastCheckin !== today) { checkinModal.style.display = 'flex'; } }
            moodButtons.forEach(button => { button.addEventListener('click', async () => { const mood = button.dataset.mood; try { await fetch('/log_mood', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ mood: mood }) }); } catch (error) { console.error("Failed to log mood:", error); } const randomIndex = Math.floor(Math.random() * affirmations.length); affirmationText.textContent = affirmations[randomIndex]; moodSelectionView.style.display = 'none'; affirmationView.style.display = 'block'; const today = new Date().toISOString().split('T')[0]; localStorage.setItem('lastCheckinDate', today); }); });
            closeModalBtn.addEventListener('click', () => { checkinModal.style.display = 'none'; });
            async function loadMoodData() { try { const response = await fetch('/get_mood_data'); const data = await response.json(); const ctx = document.getElementById('moodChart').getContext('2d'); if (moodChart) { moodChart.destroy(); } moodChart = new Chart(ctx, { type: 'line', data: { labels: data.mood_data.map(d => new Date(d.timestamp).toLocaleDateString()), datasets: [{ label: 'Average Daily Mood', data: data.mood_data.map(d => d.avg_mood), borderColor: '#67bed9', backgroundColor: 'rgba(103, 190, 217, 0.2)', tension: 0.4, fill: true, }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: -1, max: 1, title: { display: true, text: 'Mood (-1 Negative, 1 Positive)', color: '#fff' }, ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } } }, plugins: { legend: { labels: { color: '#fff' } } } } }); } catch (error) { console.error("Error loading mood data:", error); } }
            function setupNewChat(speakGreeting = false) { currentSessionId = crypto.randomUUID(); currentChatMessages = []; addMessage('bot', "Hello! I am Phoenix, your mental health chatbot. How can I help you today?", speakGreeting); chatHeader.textContent = "Phoenix"; }
            function renderChat() { chatBox.innerHTML = ''; currentChatMessages.forEach(msg => { const messageBubble = document.createElement('div'); messageBubble.className = 'chat-bubble'; messageBubble.classList.add(msg.sender === 'user' ? 'user-bubble' : 'bot-bubble'); messageBubble.innerHTML = msg.text.replace(/\n/g, '<br>'); chatBox.appendChild(messageBubble); }); chatBox.scrollTop = chatBox.scrollHeight; }
            function addMessage(sender, text, shouldSpeak = false) { currentChatMessages.push({ sender, text }); renderChat(); if (shouldSpeak && sender === 'bot') { speakMessage(text); } }
            async function sendMessage() { const message = userInput.value.trim(); if (message === '') return; addMessage('user', message); userInput.value = ''; sendButton.disabled = true; voiceButton.disabled = true; try { const response = await fetch('/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: message }) }); if (!response.ok) throw new Error('Network error'); const data = await response.json(); addMessage('bot', data.response, true); } catch (error) { console.error('Error:', error); addMessage('bot', "Sorry, I'm having trouble connecting."); } finally { sendButton.disabled = false; voiceButton.disabled = false; userInput.focus(); } }
            userInput.addEventListener('input', () => { window.speechSynthesis.cancel(); });
            sendButton.addEventListener('click', sendMessage); userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); }); saveJournalButton.addEventListener('click', saveJournal); viewJournalsButton.addEventListener('click', () => showPanel('view-journals-panel')); newPageButton.addEventListener('click', () => { journalTextarea.value = ''; });
            async function loadHistoryPanel() { historyList.innerHTML = '<p>Loading history...</p>'; try { const response = await fetch('/load_chat'); const data = await response.json(); if (data.history && data.history.length > 0) { historyList.innerHTML = ''; data.history.forEach(item => { const historyItem = document.createElement('div'); historyItem.className = 'flex items-center justify-between bg-gray-800 p-2 rounded-full'; const titleButton = document.createElement('button'); titleButton.className = 'text-left flex-1 hover:text-[#67bed9] px-4'; titleButton.textContent = item.title; titleButton.onclick = () => loadChatSession(item.id, item.title); const deleteButton = document.createElement('button'); deleteButton.className = 'text-red-500 hover:text-red-400 p-2'; deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.124-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.077-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>`; deleteButton.onclick = (e) => { e.stopPropagation(); deleteChat(item.id, historyItem); }; historyItem.appendChild(titleButton); historyItem.appendChild(deleteButton); historyList.appendChild(historyItem); }); } else { historyList.innerHTML = '<p>No saved chats found.</p>'; } } catch (error) { historyList.innerHTML = `<p class="text-red-400">Failed to load history.</p>`; } }
            async function deleteChat(sessionId, element) { if (confirm('Are you sure you want to delete this chat history?')) { try { const response = await fetch(`/delete_chat/${sessionId}`, { method: 'DELETE' }); if (!response.ok) throw new Error('Failed to delete'); element.remove(); } catch (error) { alert('Could not delete the chat history.'); } } }
            async function loadChatSession(sessionId, title) { try { const response = await fetch(`/get_chat_history/${sessionId}`); const data = await response.json(); currentSessionId = sessionId; currentChatMessages = data.history; chatHeader.textContent = title; renderChat(); showPanel('chat-panel'); } catch (error) { console.error("Error loading chat session:", error); alert("Could not load the selected chat."); } }
            async function saveJournal() { const text = journalTextarea.value.trim(); if (text === '') { alert("Journal is empty!"); return; } saveJournalButton.disabled = true; saveJournalButton.textContent = 'Saving...'; try { await fetch('/save_journal', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ text: text }) }); alert('Journal saved!'); journalTextarea.value = ''; } catch (error) { alert("Could not save journal."); } finally { saveJournalButton.disabled = false; saveJournalButton.textContent = 'Save'; } }
            async function loadJournalList() { journalList.innerHTML = '<p>Loading journals...</p>'; try { const response = await fetch('/load_journals'); const data = await response.json(); if (data.journals && data.journals.length > 0) { journalList.innerHTML = ''; data.journals.forEach(journal => { const journalItem = document.createElement('div'); journalItem.className = 'bg-gray-800 p-2 rounded-lg flex justify-between items-center'; const contentDiv = document.createElement('div'); contentDiv.className = 'cursor-pointer hover:bg-gray-700 rounded-lg p-2 flex-grow'; contentDiv.innerHTML = `<p class="font-semibold text-white">${journal.id.replace('.txt', '').replace(/_/g, ' ')}</p><p class="text-sm text-gray-400 italic truncate">${journal.preview}...</p>`; contentDiv.onclick = () => viewFullJournal(journal.id); const deleteButton = document.createElement('button'); deleteButton.className = 'text-red-500 hover:text-red-400 p-2 flex-shrink-0 ml-2'; deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.124-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.077-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>`; deleteButton.onclick = (e) => { e.stopPropagation(); deleteJournal(journal.id, journalItem); }; journalItem.appendChild(contentDiv); journalItem.appendChild(deleteButton); journalList.appendChild(journalItem); }); } else { journalList.innerHTML = '<p>No journal entries found.</p>'; } } catch (error) { journalList.innerHTML = `<p class="text-red-400">Failed to load journals.</p>`; } }
            async function deleteJournal(journalId, element) { if (confirm('Are you sure you want to delete this journal entry?')) { try { const response = await fetch(`/delete_journal/${journalId}`, { method: 'DELETE' }); if (!response.ok) throw new Error('Failed to delete'); element.remove(); } catch (error) { alert('Could not delete the journal entry.'); } } }
            window.viewFullJournal = async function(journalId) { fullJournalContent.innerHTML = '<p>Loading entry...</p>'; showPanel('full-journal-panel'); try { const response = await fetch(`/get_journal/${journalId}`); const data = await response.json(); fullJournalTitle.textContent = journalId.replace('.txt', '').replace(/_/g, ' '); fullJournalContent.textContent = data.content || "Could not load this journal entry."; } catch (error) { fullJournalContent.textContent = "An error occurred while trying to load this entry."; } }
            historyButton.addEventListener('click', () => { window.speechSynthesis.cancel(); showPanel('history-panel'); });
            newChatButton.addEventListener('click', () => { window.speechSynthesis.cancel(); setupNewChat(true); showPanel('chat-panel'); });
            voiceButton.addEventListener('click', () => {
                window.speechSynthesis.cancel();
                if (!isListening) {
                    recognition.start();
                } else {
                    recognition.stop();
                }
            });
            keyboardButton.addEventListener('click', () => { isListening = false; recognition.stop(); showPanel('chat-panel'); userInput.focus(); });
            recognition.onstart = () => { isListening = true; showPanel('listening-panel'); };
            recognition.onend = () => { isListening = false; if (document.getElementById('listening-panel').classList.contains('active')) { showPanel('chat-panel'); } };
            recognition.onresult = (event) => { userInput.value = event.results[0][0].transcript; sendMessage(); };
            recognition.onerror = (event) => { console.error('Speech recognition error', event.error); addMessage('bot', "Sorry, I couldn't understand that."); };
            window.addEventListener('beforeunload', () => { if (currentChatMessages.length > 1) { fetch('/save_chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ session_id: currentSessionId, history: currentChatMessages }), keepalive: true }).catch(err => console.error("Failed to save chat:", err)); } });

            setupNewChat(false); handleDailyCheckin(); initializeSettings(); initializeLanguage(); loadVoices();
        });
    </script>
</body>
</html>